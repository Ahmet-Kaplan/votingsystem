<link rel="import" href="../core-ajax/core-ajax.html">

<polymer-element name="votingsystem-transaction-table" attributes="url transactionBaseURL params newRecord">
    <template>
        <link rel="stylesheet" href="votingsystem-transaction-table.css" />
        <style></style>
        <core-ajax id="ajax" auto url="{{url}}" response="{{responseData}}" handleAs="json" method="get"
                   contentType="json" params="{{params}}" on-core-complete="{{ajaxComplete}}"></core-ajax>
        <div layout vertical center>
            <!--JavaFX Webkit gives problmes with tables and templates -->
            <div style="margin: 0px auto 0px auto; max-width: 1200px; overflow:auto;">
                <div layout horizontal class="tableHeadervs">
                    <div style="width:300px;">{{messages.typeLbl}}</div>
                    <div style="width:120px;">{{messages.amountLbl}}</div>
                    <div style="width:170px;">{{messages.datecreatedLbl}}</div>
                    <div style="width:280px;">{{messages.subjectLbl}}</div>
                </div>
                <div>
                    <template repeat="{{transaction in responseData.transactionRecords}}">
                        <div layout horizontal center center justified on-click="{{showUserDetails}}" class="rowvs">
                            <div style="width: 300px;">
                                <a on-click="{{openWindow}}"> {{transaction.type| transactionDescription}}</a>
                            </div>
                            <div style="width:120px;">{{transaction | amount}}</div>
                            <div style="width:170px;">{{transaction.dateCreated}}</div>
                            <div style="width:280px;">{{transaction.subject}}</div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </template>
    <script src="./i18n/messages.js"></script>
    <script>
        Polymer('votingsystem-transaction-table', {
            ready:function() {
                console.log(this.tagName + " ready - locale: " + userLocale)
                this.messages = localizedMessages
            },
            transactionDescription: function(type) {
                return getTransactionVSDescription(type)
            },
            openWindow: function(e) {
                openWindow(this.transactionBaseURL + "/" + e.target.templateInstance.model.transaction.id)
            },
            newRecordChanged: function(e) {
                console.log("newRecordChanged: " + this.newRecord)
            },
            amount: function(transaction) {
                var amount
                if(isNaN(transaction.amount)) amount = transaction.amount.toFixed(2) + " " + transaction.currency
                else  amount = transaction.amount + " " + transaction.currency
                return amount
            },
            ajaxComplete: function() { }
        });</script>
</polymer-element>
