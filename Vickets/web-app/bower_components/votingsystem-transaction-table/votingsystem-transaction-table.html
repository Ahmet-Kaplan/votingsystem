<link rel="import" href="../core-ajax/core-ajax.html">

<polymer-element name="votingsystem-transaction-table" attributes="url transactionBaseURL transactionList">
    <template>
        <link rel="stylesheet" href="votingsystem-transaction-table.css" />
        <core-ajax auto handleAs="json" url="./i18n/messages.json" response="{{locales}}"></core-ajax>
        <style></style>
        <core-ajax id="ajax" auto url="{{url}}" response="{{responseData}}" handleAs="json" method="get"
                   contentType="json"  on-core-complete="{{ajaxComplete}}"></core-ajax>
        <!--JavaFX Webkit gives problems with tables and templates -->
        <div style="margin: 0px auto 0px auto; max-width: 1200px; overflow:auto;">
            <div layout horizontal center center-justified class="tableHeadervs">
                <div flex style="width:300px;">{{messages.typeLbl}}</div>
                <div flex style="width:120px;">{{messages.amountLbl}}</div>
                <div flex style="width:170px;">{{messages.datecreatedLbl}}</div>
                <div flex style="width:280px;">{{messages.subjectLbl}}</div>
            </div>
            <div>
                <template repeat="{{transaction in transactionList}}">
                    <div layout horizontal center center justified on-click="{{showUserDetails}}" class="rowvs">
                        <div flex style="width: 300px;">
                            <a on-click="{{openWindow}}"> {{transaction.type| transactionDescription}}</a>
                        </div>
                        <div flex style="width:120px;">{{transaction | amount}}</div>
                        <div flex style="width:170px;">{{transaction.dateCreated}}</div>
                        <div flex style="width:280px;">{{transaction.subject}}</div>
                    </div>
                </template>
            </div>
        </div>
    </template>
    <script>
        Polymer('votingsystem-transaction-table', {
            localesChanged:function() {
                var results = new RegExp("[\\?&]locale=([^&#]*)").exec(location.search);
                var userLocale = ((results == null) ? "" : decodeURIComponent(results[1].replace(/\+/g, " "))) || navigator.language
                if(this.locales[userLocale]) this.messages = this.locales[userLocale]
                else this.messages = this.locales['es']
                console.log(this.tagName + " loaded locales for: " + userLocale)
            },
            ready:function() { },
            transactionDescription: function(type) {
                return getTransactionVSDescription(type)
            },
            openWindow: function(e) {
                openWindow(this.transactionBaseURL + "/" + e.target.templateInstance.model.transaction.id)
            },
            newRecordChanged: function(e) {
                console.log("newRecordChanged: " + this.newRecord)
            },
            amount: function(transaction) {
                var amount
                if(isNaN(transaction.amount)) amount = transaction.amount.toFixed(2) + " " + transaction.currency
                else  amount = transaction.amount + " " + transaction.currency
                return amount
            },
            ajaxComplete: function() {
                this.transactionList = this.responseData.transactionRecords
            }
        });</script>
</polymer-element>
