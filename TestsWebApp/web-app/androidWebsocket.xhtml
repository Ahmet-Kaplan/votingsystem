<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script type="application/javascript"><![CDATA[
    var connectionOpen = false
    var messageToService = null

    var SimulationService = {};

    SimulationService.socket = null;
    
    console.log("=========== SimulationService.connect")

    SimulationService.connect = (function(host) {

        if ('WebSocket' in window) {
            SimulationService.socket = new WebSocket(host);
        } else if ('MozWebSocket' in window) {
            SimulationService.socket = new MozWebSocket(host);
        } else {
            console.log('Navegador sin soporte WebSocket - WebSocket');
            return;
        }

        SimulationService.socket.onopen = function () {
            console.log('Info: WebSocket connection opened.');
            if(messageToService != null) {
            	SimulationService.socket.send(messageToService);
           		messageToService = null
            }
        };

        SimulationService.socket.onclose = function () {
        	console.log('Info: WebSocket closed.');
        };

        SimulationService.socket.onmessage = function (message) {
            console.log('Message from service: ' + message.data);
            if(androidClient != null) {
            
            } else {
            
            }
            
        };
    });

    SimulationService.initialize = function() {
    	console.log("=========== SimulationService.initialize")
    	var serviceURL = 'ws://sistemavotacion.org/SistemaVotacionTest/websocket/service'
        if (window.location.protocol == 'http:') {
            SimulationService.connect(serviceURL.replace('http', 'ws'));
            console.log('Connecting with: ' + serviceURL.replace('http', 'ws'));
        } else {
            SimulationService.connect(serviceURL.replace('http', 'wss'));
        }
    };

    SimulationService.sendMessage = (function(message) {
    	console.log("sendMessage to simulation service: " + message)
        if (message != '') {
            SimulationService.socket.send(message);
        }
    });

    ]]></script>
</head>
<body onload="SimulationService.initialize()">

<button onclick="SimulationService.sendMessage('button clicked')">Try it</button>
</body>
</html>