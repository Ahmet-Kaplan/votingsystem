<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                template="${'innerPage'.equals(param['mode'])? '/WEB-INF/templates/innervs.xhtml' :
                ('simplePage'.equals(param['mode']) ? '/WEB-INF/templates/simplevs.xhtml':'/WEB-INF/templates/toolbarvs.xhtml')}">
    <ui:define name="head">
        <link href="${elementURL}/transactionVS/transactionvs-list.vsp" rel="import"/>
        <link href="${elementURL}/transactionVS/transactionvs-selector.vsp" rel="import"/>
    </ui:define>
    <ui:define name="content">
        <vs-innerpage-signal caption="${msg.transactionPageTitle}"></vs-innerpage-signal>
        <div class="pageContentDiv">
            <div layout="" horizontal="" center="" center-justified="">
                <transactionvs-selector id="transactionSelector" transactionvsType="${param.transactionvsType}"></transactionvs-selector>
            </div>
            <p id="pageInfoPanel" class="text-center" style="margin: 20px auto 20px auto; font-size: 1.3em;
        background-color: #f9f9f9; max-width: 1000px; padding: 10px; display: none;"></p>
            <transactionvs-list id="currencyTransactionTable" transactionsMap='${transactionsMap}'></transactionvs-list>
        </div>
        <script>

            if(typeof sendSocketVSMessage != 'undefined') {
                document.querySelector("#coreSignals").addEventListener('core-signal-transactionvs-new', function(e) {
                    console.log("listener.gsp - core-signal-transactionvs-new")
                    document.querySelector("#currencyTransactionTable").addTransaction(e.detail)
                });
                sendSocketVSMessage({operation:Operation.LISTEN_TRANSACTIONS})
            } else console.log("listener.gsp - no socket service available")

            document.querySelector("#coreSignals").addEventListener('core-signal-transactionvs-selector-selected', function(e) {
                var transactionvsType = e.detail
                console.log("index.gsp - transactionvsType: " + transactionvsType)
                targetURL = "${restURL}/transactionVS";
                if("" != transactionvsType) {
                    targetURL = targetURL + "?transactionvsType=" + transactionvsType
                }
                history.pushState(null, null, targetURL);
                document.querySelector("#currencyTransactionTable").url = targetURL
            });

            function processSearch(textToSearch) {
                document.querySelector("#pageInfoPanel").innerHTML = "${msg.searchResultLbl} '" + textToSearch + "'"
                document.querySelector("#pageInfoPanel").style.display = "block"
                document.querySelector("#currencyTransactionTable").url = "${restURL}/transactionVS?searchText=" + textToSearch
            }

            function processSearchJSON(dataJSON) {
                document.querySelector("#currencyTransactionTable").params = dataJSON
                document.querySelector("#currencyTransactionTable").url = "${restURL}/transactionVS"
            }
        </script>
    </ui:define>
</ui:composition>
