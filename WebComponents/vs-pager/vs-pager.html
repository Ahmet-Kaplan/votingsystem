<link rel="import" href="../polymer/polymer.html">

<!--based on http://github.com/addyosmani/page-er -->
<polymer-element name="vs-pager" attributes="offset total max next previous first last rangeSize">
    <template>
        <link rel="stylesheet" href="vs-pager.css">
        <div class="pagination">
            <ul>
                <li><button on-click="{{firstPage}}">{{first}}</button></li>
                <li class='{{currentpage === 0 ? "disabled" : ""}}'>
                    <button on-click="{{prevPage}}">{{previous}}</button>
                </li>
                <template repeat="{{n in currentRange}}">
                    <li class="{{n == currentpage ? 'active' : ''}}" data-item="{{n}}" on-click="{{setPage}}">
                        <button>{{n+1}}</button>
                    </li>
                </template>
                <li class='{{currentpage === pageCount? "disabled" : ""}}'>
                    <button on-click="{{nextPage}}">{{next}}</button>
                </li>
                <li><button on-click="{{lastPage}}">{{last}}</button></li>
            </ul>
        </div>
    </template>
    <script>
        Polymer('vs-pager', {
            max: 10,
            currentRange: [],
            pageCount: 0,
            rangeSize: 10,
            currentpage:0,
            previous: "<< Prev",
            next: "Next >>",
            totalChanged: function(){
                if(typeof this.total === 'undefined') return
                this.pageCount = Math.ceil(this.total/this.max) -1
                this.currentRange = this.range();
            },
            firstPage: function () {
                this.currentpage = 0;
            },
            lastPage: function () {
                this.currentpage = this.pageCount;
            },
            prevPage: function () {
                if ( this.currentpage > 0 ) {
                    this.currentpage--;
                }
            },
            nextPage: function () {
                if ( this.currentpage < this.getPageCount() ) {
                    this.currentpage++;
                }
            },
            getPageCount: function () {
                return Math.ceil(this.total/this.max) -1
            },
            setPage: function (e) {
                this.currentpage = e.target.templateInstance.model.n
                console.log("setPage - currentpage: " + this.currentpage)
            },
            currentpageChanged: function () {
                console.log(this.tagName + " - currentpageChanged: " + this.currentpage)
                this.fire('pager-change', { offset: (this.currentpage * this.max), max: this.max });
            },
            range: function () {
                var paginations = [];
                var start = 0;
                var end =  this.rangeSize;
                if(this.currentpage - (this.rangeSize/2) > 0) start = this.currentpage - (this.rangeSize/2)
                if ( start > this.getPageCount() - this.rangeSize ) {
                    start = this.getPageCount() - this.rangeSize + 1;
                }
                if(start < 0) {
                    end = this.rangeSize + start
                    start = 0
                }
                for ( var i = start; i < start + end; i++ ) {
                    paginations.push(i);
                }
                if(paginations.length == 0) this.style.display = 'none'
                else this.style.display = 'block'
                console.log(this.tagName + " - total: " + this.total +" - offset: "  + this.offset +
                        " - max: " + this.max  +  " - paginations: " + paginations + " - pageCount: " + this.getPageCount())
                return paginations;
            }
        });
    </script>
</polymer-element>