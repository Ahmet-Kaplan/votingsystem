<dom-module name="vs-pager">
    <template>
        <link rel="stylesheet" href="vs-pager.css">
        <link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css" type="text/css"/>
        <div class="pagination horizontal layout center center-justified ">
            <div class="horizontal layout" hidden="{{prevHidden}}">
                <div class="first-child"><button on-click="firstPage"><i class="fa fa-angle-double-left"></i></button></div>
                <div class='{{prevClass}}'>
                    <button on-click="prevPage"><i class="fa fa-angle-left"></i></button>
                </div>
            </div>
            <template is="dom-repeat" items="{{selectedTagList}}">
                <div class="{{getPageClass(item)}}" data-item="{{item}}" on-click="setPage">
                    <button>{{getPageNumber(item)}}</button>
                </div>
            </template>
            <div class="horizontal layout" hidden="{{nextHidden}}">
                <div class='{{nextClass}}'>
                    <button on-click="nextPage"><i class="fa fa-angle-right"></i></button>
                </div>
                <div class="last-child"><button on-click="lastPage"><i class="fa fa-angle-double-right"></i></button></div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is:'vs-pager',
            properties: {
                offset:{type:Number},
                total:{type:Number},
                max:{type:Number},
                currentpage:{type:Number, observer:'currentpageChanged'},
                next:{type:String},
                previous:{type:String},
                first:{type:String},
                last:{type:String}
            },
            ready:function() {
                this.style.display = 'none'
                this.currentRange = []
                this.pageCount = 0
                this.rangeSize = 10
                this.previous = "<< Prev"
                this.next =  "Next >>"
            },
            currentpageChanged:function() {
                this.prevClass = (this.currentpage === 0) ? "disabled" : ""
                this.nextClass = (this.currentpage === this.pageCount) ? "disabled" : ""
                this.nextHidden = (this.currentpage === this.pageCount)
                this.prevHidden = (this.currentpage === 0)
            },
            getPageClass:function(item) {
                return item == this.currentpage ? 'active' : ''
            },
            getPageNumber:function(item) {
                return item + 1;
            },
            totalChanged: function(){
                if(typeof this.total === 'undefined') return
                this.pageCount = Math.ceil(this.total/this.max) -1
                this.currentRange = this.range();
            },
            firstPage: function () {
                this.currentpage = 0;
            },
            lastPage: function () {
                this.currentpage = this.pageCount;
            },
            prevPage: function () {
                if ( this.currentpage > 0 ) {
                    this.currentpage--;
                }
            },
            nextPage: function () {
                if ( this.currentpage < this.getPageCount() ) {
                    this.currentpage++;
                }
            },
            getPageCount: function () {
                return Math.ceil(this.total/this.max) -1
            },
            setPage: function (e) {
                this.currentpage = e.model.item
                console.log("setPage - currentpage: " + this.currentpage)
            },
            currentpageChanged: function () {
                console.log(this.tagName + " - currentpageChanged: " + this.currentpage)
                this.fire('pager-change', { offset: (this.currentpage * this.max), max: this.max });
            },
            range: function () {
                var paginations = [];
                var start = 0;
                var end =  this.rangeSize;
                if(this.currentpage - (this.rangeSize/2) > 0) start = this.currentpage - (this.rangeSize/2)
                if ( start > this.getPageCount() - this.rangeSize ) {
                    start = this.getPageCount() - this.rangeSize + 1;
                }
                if(start < 0) {
                    end = this.rangeSize + start
                    start = 0
                }
                for ( var i = start; i < start + end; i++ ) {
                    paginations.push(i);
                }
                if(this.getPageCount() > 0) this.style.display = 'block'
                else this.style.display = 'none'
                console.log(this.tagName + " - total: " + this.total +" - offset: "  + this.offset +
                " - max: " + this.max  +  " - paginations: " + paginations + " - pageCount: " + this.getPageCount())
                return paginations;
            }
        });
    </script>
</dom-module>