<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
    <f:facet name="first">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/images/icon_16/fa-bolt.png" />
    </f:facet>
    <title><ui:insert name="title" /></title>
    <h:outputScript name="js/utilsVS.js" />
    <h:outputStylesheet name="css/votingSystem.css" />
    <link href="${resourceURL}/font-awesome/css/font-awesome.min.css" media="all" rel="stylesheet" />
    <f:facet name="first">
        <script src="${resourceURL}/webcomponentsjs/webcomponents.min.js" type="text/javascript"></script>
        <!--<link href="${resourceURL}/polymer/polymer.html" rel="import"/>-->
    </f:facet>
    <link href="${elementURL}/element/votingsystem-navbar.vsp" rel="import"/>
    <script src="${contextURL}/resources/js/utils_js.jsp" type="text/javascript"></script>
    <link href="${resourceURL}/vs-socket/vs-socket.html" rel="import"/>
    <link href="${elementURL}/element/alert-dialog.vsp" rel="import"/>
    <ui:insert name="head" />
</h:head>
<h:body id="voting_system_page" style="margin: 0px; padding: 0px;">
    <div id="appTitle" style="font-size:1.5em;width: 100%; text-align: center;" tool="">{{appTitle}}</div>
    <votingsystem-navbar>
        <ui:insert name="content"/>
    </votingsystem-navbar>
    <h:messages styleClass="messages"
                style="list-style: none; padding:0; margin:0;"
                errorClass="alert alert-error" infoClass="alert alert-success"
                warnClass="alert alert-warning" globalOnly="true"/>
    <alert-dialog id="_votingsystemMessageDialog"></alert-dialog>
    <core-signals id="coreSignals"></core-signals>
    <!--<vs-socket id="socketvs" socketservice="${config.webSocketURL}"></vs-socket>-->
    <script>
        window.addEventListener('WebComponentsReady', function(e) {  });
        document.querySelector('#coreSignals').addEventListener('core-signal-vs-innerpage', function(e) {});
        document.addEventListener('polymer-ready', function() {
            console.log("main.gsp - polymer-ready")
            updateLinksVS(document.getElementsByTagName('a'))
        });

        if(document.querySelector('#socketvs')) document.querySelector('#socketvs').addEventListener('on-message', function(e) {
            console.log("main.gsp - socketvs - message: " + e.detail)
            var socketMessage = e.detail
            if(200 != socketMessage.status) {
                console.log("main.gsp - socketvs - error")
                showMessageVS(socketMessage.message, 'ERROR')
            }
        });

        function sendSocketVSMessage(dataJSON) {
            console.log ("sendSocketVSMessage")
            dataJSON.locale = navigator.language
            if(document.querySelector("#socketvs")) document.querySelector("#socketvs").sendMessage(JSON.stringify(dataJSON))
        }

        function updateSessionInfo(sessionData) {
            if(sessionData.userVSList) document.querySelector("#userSelector").userVSList = sessionData.userVSList
        }
    </script>
</h:body>
</html>