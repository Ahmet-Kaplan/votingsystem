import java.io.File;

version = '0.5.0'

subprojects {
	
	repositories {
	   mavenLocal()
	   mavenCentral()
	}

	apply plugin: 'announce'
	
	group = 'org.sistemavotacion'
}

ext {
	appletFirma = null
	appletHerramienta = null
	aplicacionAndroid = null
	downloadMonitor = null
}

task buildAll(dependsOn:['MonitorDescarga:signJar',
	'SistemaVotacionApplet:signJar', 
	'HerramientaValidacionCopiasDeSeguridad:signJar',
	'SistemaVotacionAndroid:release',
	'SistemaVotacionControlAcceso:war',
	'SistemaVotacionCentroControl:war',
	'SistemaVotacionTest:buildJar']) << {
	
}
	
task genWebAppsCerts(type: CertGenerator) << {task ->
	File controlAccesoKeyStoreFile = new File("$projectDir/SistemaVotacionControlAcceso/web-app/WEB-INF/cms/ControlAcceso.jks");
	task.genUserKeyStore(project.controlAccesoDN, controlAccesoKeyStoreFile, project.controlAccesoCertAlias)
	
	File centroControlKeyStoreFile = new File("$projectDir/SistemaVotacionCentroControl/web-app/WEB-INF/cms/CentroControl.jks");
	task.genUserKeyStore(project.centroControlDN, centroControlKeyStoreFile, project.centroControlCertAlias)
	
}

genWebAppsCerts.doFirst {
	rootCertFile = new File("$projectDir/webAppsRootCert.jks")
	rootCertNIF = project.rootCertNIF
	rootSubjectDN = project.rootSubjectDN
	password = project.keyStorePassword
}

task genAppsCerts(type: CertGenerator) << {task ->
	File appsKeyStoreFile = new File("$projectDir/mockDnie1.jks");
	task.genUserKeyStore(project.appCertDN, appsKeyStoreFile, project.signKeyAlias)
}

genAppsCerts.doFirst {
	rootCertFile = new File("$projectDir/appsRootCert.jks")
	rootCertNIF = project.rootCertNIF
	rootSubjectDN = project.rootSubjectDN
	password = project.keyStorePassword
}
// This is a task that generates the gradlew scripts, allowing users to run gradle without having gradle installed
// on their system.
// This task should be run by "build master" and the resulting output committed to source control.  Its outputs include:
//  1) /gradlew which is the *NIX shell script for executing builds
//  2) /gradlew.bat which is the windows bat script for for executing builds
//  3) /wrapper which is a directory named by the "jarPath" config which contains other needed files.
task wrapper(type: Wrapper) {
	gradleVersion = '1.3'
}
